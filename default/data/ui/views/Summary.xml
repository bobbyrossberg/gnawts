<view autoCancelInterval="90" isVisible="true" onunloadCancelJobs="true" template="dashboard.html" isSticky="False">
  <label>Summary</label>
  <module name="AccountBar" layoutPanel="appHeader" />
  <module name="AppBar" layoutPanel="appHeader" />
  <module name="SideviewUtils" layoutPanel="appHeader" />
  
  <module name="Message" layoutPanel="messaging">
    <param name="filter">*</param>
    <param name="maxSize">2</param>
    <param name="clearOnJobDispatch">False</param>
  </module>

  <!-- a standard search bar -->
  <module name="SearchBar" layoutPanel="splSearchControls-inline">
        <param name="useAssistant">true</param>
        <param name="useTypeahead">true</param>
        <param name="useOwnSubmitButton">False</param>
        <module name="TimeRangePicker">
            <param name="selected">All time</param>
            <param name="searchWhenChanged">False</param>
            <module name="SubmitButton">
                <param name="allowSoftSubmit">True</param>
                <module name="ViewRedirector" layoutPanel="viewHeader">
                    <param name="viewTarget">flashtimeline</param>
                </module>
            </module>
        </module>
  </module>
    
  <module name="Search" layoutPanel="panel_row1_col1" group="Summary of the last 60 minutes" autoRun="True">
   <param name="search">index=_internal source=*metrics.log group=per_index_thruput series=hpc_* | eval system=ltrim(series,"hpc_")  | chart sum(ev) AS MessageCount sum(kb) AS KB by system | eval TotalMB=KB/1024 | fields + system MessageCount TotalMB | sort -MessageCount</param>
   <param name="earliest">-1h</param>
   <module name="Pager">
    <param name="entityName">results</param>
    <module name="SimpleResultsTable">
     <param name="displayRowNumbers">False</param>
     <param name="entityName">results</param>
    </module>   
        </module>         
  </module>    
    
  <module name="Search" layoutPanel="panel_row1_col2" group="Logs in a job" autoRun="True">

   <!-- Get a list of systems based on what hpc_* indexes exist -->
   <param name="search">| eventcount summarize=false | search index=hpc_* | eval system=ltrim(index,"hpc_") | fields system</param>

   <!-- How to render all the below on a single line? -->
   <!-- Enter a job number -->
   <module name="TextField">
    <param name="name">job</param>
    <param name="label">Show logs for the latest job numbered:</param>
    <param name="width">7em</param>

    <!-- Offer a list of systems -->
    <module name="Pulldown">
      <param name="name">selectedSystem</param>
      <param name="label">On system:</param>
      <param name="searchFieldsToDisplay">
        <list>
          <param name="label">system</param>
          <param name="value">system</param>
        </list>
      </param>
    
		<!-- Kick off a search -->
        <module name="Search">
          <param name="search">`job($job$,hpc_$selectedSystem$)`</param>
          <param name="earliest">-30d</param>
          <param name="latest">now</param>
        
        <!-- Popup a new window containing the search results -->
        <module name="ViewRedirector">
          <param name="viewTarget">flashtimeline</param>
          <param name="popup">True</param>
        </module>
        
       </module>
     </module>
    </module>
  </module>
  
  <module name="Search" layoutPanel="panel_row2_col1" group="Messages Of Interest" autoRun="True">
        
   <!-- Get a list of systems based on what hpc_* indexes exist -->
   <param name="search">| eventcount summarize=false | search index=hpc_* | eval system=ltrim(index,"hpc_") | fields system</param>
    
    <!-- Offer a list of systems -->
    <module name="Pulldown">
      <param name="name">selectedSystems</param>
      <param name="label">Systems to include:</param>
      <param name="size">4</param>
      <param name="template">index=hpc_$value$</param>
      <param name="separator">+OR+</param>
      <param name="outerTemplate">($value$)</param>
      <param name="staticFieldsToDisplay"></param>
      <param name="searchFieldsToDisplay">
        <list>
          <param name="label">system</param>
          <param name="value">system</param>
        </list>
      </param>
      
      <module name="TextField">
        <param name="name">earliest</param>
        <param name="label">earliest:</param>
        <param name="default">-24h</param>
        <param name="width">4em</param>
       <module name="TextField">
        <param name="name">latest</param>
        <param name="label">latest:</param>
        <param name="default">now</param>
        <param name="width">4em</param>

	  <!-- would like to make this smaller, maybe replace earliest/lastest with a time picker -->
      <module name="Search">
        <param name="search">tag=moi earliest=$earliest$ latest=$latest$ $selectedSystems$ | ctable host eventtype </param>
        <param name="earliest">-1d</param>
        <param name="latest">now</param>
           
        <!-- User education -->
        <module name="HTML">
          <param name="html"><![CDATA[
            Below table generated via: <b>$search$</b>
            ]]></param>
        </module>
        
        <module name="Pager">
          <param name="entityName">results</param>
          <module name="SimpleResultsTable">
            <param name="displayRowNumbers">False</param>
            <param name="entityName">results</param>
            <param name="drilldown">row</param>
            
           <module name="Search">
            <param name="search">tag=moi host=$click.fields.host$</param>
            <param name="earliest">-1d</param>
            <param name="latest">now</param>
        
            <!-- Popup a new window containing the search results -->
            <module name="ViewRedirector">
              <param name="viewTarget">flashtimeline</param>
              <param name="popup">True</param>
            </module>
           </module>
          </module>
        </module>
  
        </module>
  
        </module>
  
      </module>
    </module>
  </module>
  
</view>
